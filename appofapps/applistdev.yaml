apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: nginx-app
spec:
  generators:
    - list:
        elements:
          - cluster: dev
            url: https://kubernetes.default.svc
            path: ./mychart/dev
          - cluster: qa
            url: https://kubernetes.default.svc
            path: ./mychart/qa
          
  template:
    metadata:
      name: nginx-{{cluster}} # Application name based on cluster
    spec:
      project: default
      source:
        repoURL: 'git@github.com:danish21385/gitops.git' # Replace with your Git repo URL
        targetRevision: dev
        path: '{{path}}' # Use the path for the specific directory
      destination:
        server: '{{url}}' # Set the server URL dynamically
        namespace: '{{cluster}}' # Target namespace
      syncPolicy:
        syncOptions:
         - CreateNamespace=true
        automated:
          prune: true
          selfHeal: true

